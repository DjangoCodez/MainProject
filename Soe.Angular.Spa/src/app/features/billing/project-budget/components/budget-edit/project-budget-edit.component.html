@if (form?.getIdControl()?.value) {
  <soe-toolbar
    [recordConfig]="recordConfig"
    [form]="form"
    [itemGroups]="toolbarService.toolbarItemGroups"
    (navigatorRecordChanged)="navigatorRecordChanged($event)">
    <ng-content
      toolbar-content-left
      select="[toolbar-content-left]"></ng-content>
  </soe-toolbar>
}

@if (form) {
  <form [formGroup]="form" class="soe-edit-form" novalidate autocomplete="off">
    <soe-expansion-panel [labelKey]="budgetTypeText()" [static]="true">
      <div class="row">
        <div class="col-sm-4">
          <!-- PROJECT -->
          <div class="row no-margin" style="padding-bottom: 20px">
            <div class="row">
              <div class="col-sm-3">
                <soe-textbox
                  [labelKey]="'common.report.selection.projectname'"
                  formControlName="projectName"
                  [manualReadOnly]="true"></soe-textbox>
              </div>
              <div class="col-sm-3">
                <soe-textbox
                  [labelKey]="'billing.order.projectnr'"
                  formControlName="projectNr"
                  [manualReadOnly]="true"></soe-textbox>
              </div>
              <div class="col-sm-3">
                <soe-datepicker
                  [labelKey]="'billing.projects.list.startdate'"
                  formControlName="projectFromDate"
                  [manualReadOnly]="true"></soe-datepicker>
              </div>
              <div class="col-sm-3">
                <soe-datepicker
                  [labelKey]="'billing.projects.list.stopdate'"
                  formControlName="projectToDate"
                  [manualReadOnly]="true"></soe-datepicker>
              </div>
            </div>
          </div>

          <!-- BUDGET -->
          <div class="row">
            <div class="col-sm-12">
              <soe-textbox [labelKey]="'common.name'" formControlName="name">
              </soe-textbox>
            </div>
          </div>
        </div>
        <div class="col-sm-8">
          <!-- KPI -->
          <div
            class="table-responsive"
            style="
              background-color: #daeafb;
              border: 1px solid #90b6da;
              border-radius: 10px;
              padding: 16px;
            ">
            <table
              class="table table-borderless table-sm text-end align-middle"
              style="background-color: #daeafb; margin-bottom: 0">
              <thead>
                <tr>
                  <th style="background-color: #daeafb; border: none"></th>
                  <th
                    colspan="2"
                    style="
                      background-color: #daeafb;
                      border: none;
                      padding-bottom: 0px;
                    ">
                    <div
                      style="
                        font-size: 1.6rem;
                        font-weight: bold;
                        text-align: left;
                      ">
                      @if (isProjectBudgetForecast()) {
                        {{ terms['billing.projects.budget.forecast'] }}
                      } @else if (isProjectBudgetIB()) {
                        {{
                          terms['billing.projects.budget.budgetopeningbalance']
                        }}
                      } @else {
                        {{ terms['billing.project.central.budget'] }}
                      }
                    </div>
                  </th>
                  @if (isProjectBudgetForecast()) {
                    <th
                      colspan="3"
                      style="
                        background-color: #e6f1fc;
                        border: 0px solid #e6f1fc;
                        border-top-left-radius: 10px;
                        border-top-right-radius: 10px;
                        padding-bottom: 0px;
                      ">
                      <div
                        style="
                          font-size: 1.6rem;
                          font-weight: bold;
                          text-align: left;
                        ">
                        {{ terms['billing.project.central.outcome'] }}
                      </div>
                    </th>
                    <th
                      colspan="3"
                      style="
                        background-color: #daeafb;
                        border: none;
                        padding-bottom: 0px;
                      ">
                      <div
                        style="
                          font-size: 1.6rem;
                          font-weight: bold;
                          text-align: left;
                        ">
                        {{ terms['billing.project.central.budget'] }}
                      </div>
                    </th>
                  }
                </tr>
                @if (isProjectBudgetForecast()) {
                  <tr>
                    <th style="background-color: #daeafb; border: none"></th>
                    <th
                      colspan="2"
                      style="background-color: #daeafb; border: none"></th>

                    <th
                      colspan="3"
                      style="
                        background-color: #e6f1fc;
                        border: 0px solid #e6f1fc;
                        color: #6e6e6e;
                      ">
                      <div
                        style="
                          font-size: 0.75rem;
                          font-weight: bold;
                          text-align: left;
                        ">
                        {{ resultUpdatedText() }}
                      </div>
                    </th>
                    <th
                      colspan="3"
                      style="background-color: #daeafb; border: none">
                      <div
                        style="
                          font-size: 0.75rem;
                          font-weight: bold;
                          text-align: left;
                          color: #6e6e6e;
                        ">
                        {{ compBudgetName() }}
                      </div>
                    </th>
                  </tr>
                }
                <tr
                  style="
                    background-color: #daeafb;
                    border-bottom: #222 2px solid;
                  ">
                  <th style="background-color: #daeafb; border: none"></th>
                  <th style="background-color: #daeafb; font-weight: bold">
                    {{ terms['common.amount'] }}
                  </th>
                  <th style="background-color: #daeafb; font-weight: bold">
                    {{ terms['core.time.hours'] }}
                  </th>
                  @if (isProjectBudgetForecast()) {
                    <th style="background-color: #e6f1fc; font-weight: bold">
                      {{ terms['common.amount'] }}
                    </th>
                    <th style="background-color: #e6f1fc; font-weight: bold">
                      {{ terms['core.time.hours'] }}
                    </th>
                    <th style="background-color: #e6f1fc; font-weight: bold">
                      {{ terms['billing.projects.budget.difforecast'] }}
                    </th>
                    <th style="background-color: #daeafb; font-weight: bold">
                      {{ terms['common.amount'] }}
                    </th>
                    <th style="background-color: #daeafb; font-weight: bold">
                      {{ terms['core.time.hours'] }}
                    </th>
                    <th style="background-color: #daeafb; font-weight: bold">
                      {{ terms['billing.projects.budget.difforecast'] }}
                    </th>
                  }
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td
                    style="
                      background-color: #daeafb;
                      font-weight: bold;
                      text-align: left;
                    ">
                    {{ terms['billing.projects.list.budgetincometotal'] }}
                  </td>
                  <td style="background-color: #daeafb; font-weight: bold">
                    {{ incomeTotal | number: '1.2-2' }}
                  </td>
                  <td style="background-color: #daeafb; font-weight: bold"></td>
                  @if (isProjectBudgetForecast()) {
                    <td style="background-color: #e6f1fc; font-weight: bold">
                      {{ incomeTotalResult | number: '1.2-2' }}
                    </td>
                    <td
                      style="background-color: #e6f1fc; font-weight: bold"></td>
                    <td style="background-color: #e6f1fc; font-weight: bold">
                      {{ incomeTotalDiffResult | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #daeafb; font-weight: bold">
                      {{ incomeTotalComparableBudget | number: '1.2-2' }}
                    </td>
                    <td
                      style="background-color: #daeafb; font-weight: bold"></td>
                    <td style="background-color: #daeafb; font-weight: bold">
                      {{ incomeTotalDiffComparableBudget | number: '1.2-2' }}
                    </td>
                  }
                </tr>
                <tr style="background-color: #daeafb">
                  <td style="background-color: #daeafb; text-align: left">
                    {{ terms['billing.projects.list.budgetcostpersonal'] }}
                  </td>
                  <td style="background-color: #daeafb">
                    {{ costPersonell | number: '1.2-2' }}
                  </td>
                  <td style="background-color: #daeafb">
                    {{ totalHours | number: '1.0-0' }}h
                  </td>
                  @if (isProjectBudgetForecast()) {
                    <td style="background-color: #e6f1fc">
                      {{ costPersonellResult | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #e6f1fc">
                      {{ totalHoursResult | number: '1.0-0' }}h
                    </td>
                    <td style="background-color: #e6f1fc">
                      {{ costPersonellDiffResult | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #daeafb">
                      {{ costPersonellComparableBudget | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #daeafb">
                      {{ totalHoursComparableBudget | number: '1.0-0' }}h
                    </td>
                    <td style="background-color: #daeafb">
                      {{ costPersonellDiffComparableBudget | number: '1.2-2' }}
                    </td>
                  }
                </tr>
                <tr style="background-color: #daeafb">
                  <td style="background-color: #daeafb; text-align: left">
                    {{ terms['billing.projects.list.budgetcostmaterial'] }}
                  </td>
                  <td style="background-color: #daeafb">
                    {{ costMaterial | number: '1.2-2' }}
                  </td>
                  <td style="background-color: #daeafb"></td>
                  @if (isProjectBudgetForecast()) {
                    <td style="background-color: #e6f1fc">
                      {{ costMaterialResult | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #e6f1fc"></td>
                    <td style="background-color: #e6f1fc">
                      {{ costMaterialDiffResult | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #daeafb">
                      {{ costMaterialComparableBudget | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #daeafb"></td>
                    <td style="background-color: #daeafb">
                      {{ costMaterialDiffComparableBudget | number: '1.2-2' }}
                    </td>
                  }
                </tr>
                <tr style="background-color: #daeafb">
                  <td style="background-color: #daeafb; text-align: left">
                    {{ terms['billing.projects.list.budgetcost'] }}
                  </td>
                  <td style="background-color: #daeafb">
                    {{ costExpense | number: '1.2-2' }}
                  </td>
                  <td style="background-color: #daeafb"></td>
                  @if (isProjectBudgetForecast()) {
                    <td style="background-color: #e6f1fc">
                      {{ costExpenseResult | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #e6f1fc"></td>
                    <td style="background-color: #e6f1fc">
                      {{ costExpenseDiffResult | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #daeafb">
                      {{ costExpenseComparableBudget | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #daeafb"></td>
                    <td style="background-color: #daeafb">
                      {{ costExpenseDiffComparableBudget | number: '1.2-2' }}
                    </td>
                  }
                </tr>
                <tr style="background-color: #daeafb">
                  <td style="background-color: #daeafb; text-align: left">
                    {{ terms['billing.projects.list.budgetoverhead'] }}
                  </td>
                  <td style="background-color: #daeafb">
                    {{ costOverhead | number: '1.2-2' }}
                  </td>
                  <td style="background-color: #daeafb"></td>
                  @if (isProjectBudgetForecast()) {
                    <td style="background-color: #e6f1fc">
                      {{ costOverheadResult | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #e6f1fc"></td>
                    <td style="background-color: #e6f1fc">
                      {{ costOverheadDiffResult | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #daeafb">
                      {{ costOverheadComparableBudget | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #daeafb"></td>
                    <td style="background-color: #daeafb">
                      {{ costOverheadDiffComparableBudget | number: '1.2-2' }}
                    </td>
                  }
                </tr>
                <tr
                  style="
                    background-color: #daeafb;
                    border-bottom: #222 2px solid;
                    padding-bottom: 4px;
                  ">
                  <td
                    style="
                      background-color: #daeafb;
                      font-weight: bold;
                      text-align: left;
                    ">
                    {{ terms['billing.projects.list.budgetcosttotal'] }}
                  </td>
                  <td style="background-color: #daeafb; font-weight: bold">
                    {{ costTotal | number: '1.2-2' }}
                  </td>
                  <td style="background-color: #daeafb; font-weight: bold"></td>
                  @if (isProjectBudgetForecast()) {
                    <td style="background-color: #e6f1fc; font-weight: bold">
                      {{ costTotalResult | number: '1.2-2' }}
                    </td>
                    <td
                      style="background-color: #e6f1fc; font-weight: bold"></td>
                    <td style="background-color: #e6f1fc; font-weight: bold">
                      {{ costTotalDiffResult | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #daeafb; font-weight: bold">
                      {{ costTotalComparableBudget | number: '1.2-2' }}
                    </td>
                    <td
                      style="background-color: #daeafb; font-weight: bold"></td>
                    <td style="background-color: #daeafb; font-weight: bold">
                      {{ costTotalDiffComparableBudget | number: '1.2-2' }}
                    </td>
                  }
                </tr>
                <tr style="background-color: #daeafb">
                  <td
                    style="
                      background-color: #daeafb;
                      font-weight: bold;
                      text-align: left;
                    ">
                    {{ terms['billing.projects.budget.contributionmargin'] }}
                  </td>
                  <td style="background-color: #daeafb; font-weight: bold">
                    {{ result | number: '1.2-2' }}
                  </td>
                  <td style="background-color: #daeafb; font-weight: bold"></td>
                  @if (isProjectBudgetForecast()) {
                    <td style="font-weight: bold; background-color: #e6f1fc">
                      {{ resultResult | number: '1.2-2' }}
                    </td>
                    <td
                      style="font-weight: bold; background-color: #e6f1fc"></td>
                    <td style="font-weight: bold; background-color: #e6f1fc">
                      {{ resultDiffResult | number: '1.2-2' }}
                    </td>
                    <td style="background-color: #daeafb; font-weight: bold">
                      {{ resultComparableBudget | number: '1.2-2' }}
                    </td>
                    <td
                      style="background-color: #daeafb; font-weight: bold"></td>
                    <td style="background-color: #daeafb; font-weight: bold">
                      {{ resultDiffComparableBudget | number: '1.2-2' }}
                    </td>
                  }
                </tr>
                <tr style="background-color: #daeafb">
                  <td
                    style="
                      background-color: #daeafb;
                      font-weight: bold;
                      text-align: left;
                    ">
                    {{ terms['common.customer.customer.marginalincomeratio'] }}
                  </td>
                  <td style="background-color: #daeafb; font-weight: bold">
                    {{ resultRatio }}
                  </td>
                  <td style="background-color: #daeafb"></td>
                  @if (isProjectBudgetForecast()) {
                    <td
                      style="
                        background-color: #e6f1fc;
                        font-weight: bold;
                        border-bottom-left-radius: 10px;
                      ">
                      {{ resultRatioResult }}
                    </td>
                    <td style="background-color: #e6f1fc"></td>
                    <td
                      style="
                        background-color: #e6f1fc;
                        border-bottom-right-radius: 10px;
                      "></td>
                    <td style="background-color: #daeafb; font-weight: bold">
                      {{ resultRatioComparableBudget }}
                    </td>
                    <td style="background-color: #daeafb"></td>
                    <td style="background-color: #daeafb"></td>
                  }
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <br />
      <div class="row">
        @if (!isLoadingBudgetHead()) {
          <div class="col-sm-12">
            <soe-project-budget-edit-simple-grid
              [rowAction]="budgetRowAction"
              [isGridDisabled]="isProjectBudgetLocked()"
              [isProjectBudgetForecast]="isProjectBudgetForecast()"
              [compBudgetName]="compBudgetName()"
              [resultUpdatedText]="resultUpdatedText()"
              (rowsChanged)="
                rowsChanged($event)
              "></soe-project-budget-edit-simple-grid>
          </div>
        }
      </div>
    </soe-expansion-panel>
    <soe-edit-footer
      [form]="form"
      [idFieldName]="idFieldName"
      [modifyPermission]="flowHandler.modifyPermission()"
      [inProgress]="performAction.inProgress()"
      [hideSave]="budgetHeadStatus === 2"
      [hideDelete]="budgetHeadStatus === 2"
      (saved)="performSave()"
      (deleted)="triggerDelete()">
      @if (budgetHeadStatus !== 2) {
        <div pageButtons>
          <soe-button
            [caption]="'economy.accounting.budget.lock'"
            [behaviour]="'standard'"
            (action)="lock()"
            class="ms-2">
          </soe-button>
        </div>
      }
      @if (budgetHeadStatus === 2) {
        <div pageButtons>
          <soe-button
            [caption]="'economy.accounting.budget.unlock'"
            [behaviour]="'standard'"
            (action)="unlock()"
            class="ms-2">
          </soe-button>
        </div>
      }
    </soe-edit-footer>
  </form>
}
