<data-ng-include src="ctrl.timeTreeUrl"></data-ng-include>

<div class="timetree-container" style="min-width:300px">
    <div class="timetree-header">

        <!--Period Selector-->
        <div class="payrollcalculation-periodselector">
            <div class="row">
                <div class="col-sm-12">
                    <soe-select label-key="time.time.timeperiod.timeperiodhead" model="ctrl.currentTimePeriodHeadId" items="ctrl.timePeriodHeads" options="item.id as item.name for item in items" on-changing="ctrl.timePeriodHeadSelected(item)" is-disabled="ctrl.loadingTree"></soe-select>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <soe-select label-key="time.time.timeperiod.paymentdate" model="ctrl.currentTimePeriodId" items="ctrl.timePeriods" options="item.timePeriodId as item.paymentDateString for item in items" is-disabled="!ctrl.timePeriods"></soe-select>
                </div>
            </div>
        </div>

        <!--Selection-->
        <div class="timetree-header-input-filter form-inline" data-ng-show="!ctrl.loadingTree && ctrl.currentTimePeriodId > 0">
            <div class="form-group form-group-sm" data-ng-if="!ctrl.companyUseAccountHierarchy" style="margin-right: 0px;margin-top: 5px">
                <soe-multiselect label-key="common.categories" hidelabel="true" options="ctrl.toolbarSelectionCategories" model="ctrl.toolbarSelectionCategoriesSelected" is-disabled="ctrl.toolbarSelectionCategoriesDisabled()" on-selection-complete="ctrl.toolbarSelectionCategoriesChanged()"></soe-multiselect>
            </div>
            <div class="form-group form-group-sm" data-ng-if="ctrl.companyUseAccountHierarchy" style="margin-right: 0px;margin-top: 5px">
                <soe-multiselect label-key="time.time.attest.accounts" hidelabel="true" options="ctrl.toolbarSelectionAccounts" model="ctrl.toolbarSelectionAccountsSelected" is-disabled="ctrl.toolbarSelectionAccountsDisabled()" on-selection-complete="ctrl.toolbarSelectionAccountsChanged()"></soe-multiselect>
            </div>
            <div class="form-group form-group-sm" style="margin-right: 0px;margin-top: 5px">
                <soe-multiselect label-key="common.employees" hidelabel="true" options="ctrl.toolbarSelectionEmployees" model="ctrl.toolbarSelectionEmployeesSelected" is-disabled="ctrl.toolbarSelectionEmployeesDisabled()" on-selection-complete="ctrl.toolbarSelectionEmployeesChanged()"></soe-multiselect>
            </div>
            <div class="form-group form-group-sm" style="margin-right: 0px;margin-top: 5px">
                <soe-multiselect label-key="time.atteststate.state" hidelabel="true" options="ctrl.toolbarSelectionAttestStates" model="ctrl.toolbarSelectionAttestStatesSelected" is-disabled="ctrl.toolbarSelectionAttestStatesDisabled()" on-selection-complete="ctrl.toolbarSelectionAttestStatesChanged()"></soe-multiselect>
            </div>
        </div>

        <!--Toolbar-->
        <div class="timetree-header-toolbar">
            <div class="timetree-header-toolbar-buttons">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="btn-group pull-left timetree-header-toolbar-buttons-left">
                            <button type="button" class="btn btn-default" data-ng-class="{ active: ctrl.isToolbarFilterActiveOrOpen()}" data-ng-click="$event.stopPropagation();ctrl.toolbarFilterShow()">
                                <span data-l10n-bind data-l10n-bind-title="'core.filter'" data-ng-class="{ 'fas fa-filter': ctrl.isToolbarFilterActiveOrOpen(), 'fal fa-filter': !ctrl.isToolbarFilterActiveOrOpen() }"></span>
                            </button>
                            <button type="button" class="btn btn-default" data-ng-class="{ active: ctrl.toolbarGroupingActive, disabled: ctrl.toolbarGroupingDisabled() }" data-ng-click="$event.stopPropagation();!ctrl.toolbarGroupingDisabled() && ctrl.toolbarGroupingShow()">
                                <span data-l10n-bind data-l10n-bind-title="'core.group'" class="fal fa-th-list"></span>
                            </button>
                            <button type="button" class="btn btn-default" data-ng-class="{ active: ctrl.toolbarSortingActive, disabled: ctrl.toolbarSortingDisabled() }" data-ng-click="$event.stopPropagation();!ctrl.toolbarSortingDisabled() && ctrl.toolbarSortingShow()">
                                <span data-l10n-bind data-l10n-bind-title="'core.sorting'" class="fal fa-sort-amount-down-alt"></span>
                            </button>
                        </div>
                        <div class="btn-group pull-left timetree-header-toolbar-buttons-left">
                            <button type="button" class="btn btn-default" data-ng-class="{ disabled: ctrl.toolbarPrevPeriodDisabled() }" data-ng-click="$event.stopPropagation();!ctrl.toolbarPrevPeriodDisabled() && ctrl.toolbarPrevPeriodGoTo()">
                                <span data-l10n-bind data-l10n-bind-title="'core.previous'" class="fal fa-chevron-left"></span>
                            </button>
                            <button type="button" class="btn btn-default" data-ng-class="{ disabled: ctrl.toolbarNextPeriodDisabled() }" data-ng-click="$event.stopPropagation();!ctrl.toolbarNextPeriodDisabled() && ctrl.toolbarNextPeriodGoTo()">
                                <span data-l10n-bind data-l10n-bind-title="'core.next'" class="fal fa-chevron-right"></span>
                            </button>
                        </div>
                        <div class="btn-group pull-right timetree-header-toolbar-buttons-right">
                            <button type="button" class="btn btn-default" data-ng-class="{ disabled: ctrl.toolbarLoadTreeDisabled() }" data-ng-click="$event.stopPropagation();ctrl.toolbarSelectionClear()">
                                <span data-l10n-bind data-l10n-bind-title="'time.time.tree.clearselection'" class="fal fa-times iconDelete"></span>
                            </button>
                            <button type="button" class="btn btn-default" data-ng-class="{ disabled: ctrl.toolbarLoadTreeDisabled() }" data-ng-click="$event.stopPropagation();!ctrl.toolbarLoadTreeDisabled() && ctrl.toolbarReload()">
                                <span data-l10n-bind data-l10n-bind-title="'time.time.tree.reload'" class="fal fa-sync"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="timetree-header-toolbar-box" data-ng-show="ctrl.toolbarFilterActive">
                <div class="row">
                    <div class="col-sm-12">
                        <soe-checkbox label-key="time.time.tree.disableautoload.setting" model="ctrl.userSettingPayrollCalculationTreeDisableAutoLoad" on-changing="$event.stopPropagation();ctrl.toolbarDisableAutoLoadChanged()"></soe-checkbox>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <soe-checkbox label-key="time.time.tree.ignoreemploymentstopdate" model="ctrl.toolbarSelectionIgnoreEmploymentStopDate"></soe-checkbox>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <soe-checkbox label-key="time.time.tree.donotshowcalculated" model="ctrl.userSettingPayrollCalculationTreeDoNotShowCalculated" on-changing="$event.stopPropagation();ctrl.toolbarDoNotShowCalculatedChanged()"></soe-checkbox>
                    </div>
                </div>                
                <div class="row">
                    <div class="col-sm-12">
                        <soe-checkbox label-key="time.payroll.payrollcalculation.tree.showonlyapplyfinalsalary" model="ctrl.toolbarSelectionShowOnlyApplyFinalSalary" on-changing="$event.stopPropagation();ctrl.toolbarSelectionShowOnlyApplyFinalSalaryChanged()"></soe-checkbox>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <soe-checkbox label-key="time.payroll.payrollcalculation.tree.showonlyappliedfinalsalary" model="ctrl.toolbarSelectionShowOnlyAppliedFinalSalary" on-changing="$event.stopPropagation();ctrl.toolbarSelectionShowOnlyAppliedFinalSalaryChanged()"></soe-checkbox>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-10">
                        <soe-select label-key="time.payroll.payrollcalculation.tree.warningfilter" class="col-sm-12" model="ctrl.userSettingPayrollCalculationTreeWarningFilter" items="ctrl.toolbarWarningFilter" options="item.id as item.name for item in items" on-changing="$event.stopPropagation();ctrl.toolbarFilterOnWarnings(item)"></soe-select>
                    </div>
                </div>
            </div>
            <div class="timetree-header-toolbar-box" data-ng-show="ctrl.toolbarGroupingActive">
                <div class="row">
                    <soe-select class="col-sm-12" label-key="core.groupon" model="ctrl.userSettingPayrollCalculationTreeLatestGrouping" items="ctrl.toolbarGroupingOptions" options="item.id as item.name for item in items" on-changing="$event.stopPropagation();ctrl.toolbarGroupingChanged(item)"></soe-select>
                </div>
            </div>
            <div class="timetree-header-toolbar-box" data-ng-show="ctrl.toolbarSortingActive">
                <div class="row">
                    <soe-select class="col-sm-12" label-key="core.sortingon" model="ctrl.userSettingPayrollCalculationTreeLatestSorting " items="ctrl.toolbarSortingOptions" options="item.id as item.name for item in items" on-changing="$event.stopPropagation();ctrl.toolbarSortingChanged(item)"></soe-select>
                </div>
            </div>
        </div>

        <!-- Input -->
        <div class="timetree-header-input">
            <div class="timetree-header-input-search" data-ng-show="!ctrl.loadingTree && ctrl.currentTimePeriodId > 0  && ctrl.userSettingPayrollCalculationTreeDisableAutoLoad">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="input-group">
                            <input type="text" class="form-control" data-ng-model="ctrl.toolbarSearchPatternInput" data-l10n-bind data-l10n-bind-placeholder="ctrl.getSearchWatermark()" data-ng-if="ctrl.modifyPermissionsLoaded" enter="ctrl.toolbarSearch()">
                            <span class="input-group-btn">
                                <button data-l10n-bind data-l10n-bind-title="'core.search'" type="button" class="btn btn-sm btn-default fal fa-search accentColor" ng-disabled="!ctrl.hasToolbarSearchPatternInput()" data-ng-click="$event.stopPropagation();ctrl.toolbarSearch()"></button>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--Filter-->
    <div class="timetree-filter" data-ng-if="ctrl.tree && !ctrl.loadingTree">
        <div class="row">
            <div class="col-sm-12">
                <input type="text" class="form-control" data-ng-model="ctrl.treeFilterTextInput" data-ng-change="ctrl.treeFilterChanged()" data-l10n-bind data-l10n-bind-placeholder="'time.time.tree.filter'" ignore-dirty="true">
            </div>
        </div>
    </div>

    <!--Progress-->
    <div class="timetree-progress" data-ng-if="ctrl.loadingTree || (!ctrl.loadingTree && ctrl.userSettingPayrollCalculationTreeDisableAutoLoad && !ctrl.tree)">
        <div class="timetree-progress-loading" data-ng-if="ctrl.loadingTree">
            <div class="row">
                <div class="col-sm-12">
                    <div>
                        <soe-progressbar is-busy="ctrl.loadingTree" message="ctrl.progressMessage"></soe-progressbar>
                    </div>
                </div>
            </div>
        </div>
        <div class="timetree-progress-disabled" data-ng-if="!ctrl.loadingTree && ctrl.userSettingPayrollCalculationTreeDisableAutoLoad && !ctrl.tree">
            <div class="row">
                <div class="col-sm-12">
                    <div class="timetree-progress-disabled-message info">
                        <ul>
                            <li><span data-l10n-bind="'time.time.tree.disableautoload'"></span></li>
                            <li><i class="fal fa-search"></i>&nbsp;<span data-l10n-bind="ctrl.getSearchDescription()"></span></li>
                            <li data-ng-if="!ctrl.companyUseAccountHierarchy"><span class="fal fa-caret-down"></span>&nbsp;&nbsp;<span data-l10n-bind="'time.time.tree.disableautoload.choice2selection.categories'"></span></li>
                            <li data-ng-if="ctrl.companyUseAccountHierarchy"><span class="fal fa-caret-down"></span>&nbsp;&nbsp;<span data-l10n-bind="'time.time.tree.disableautoload.choice2selection.accounts'"></span></li>
                            <li><i class="fal fa-sync"></i>&nbsp;<span data-l10n-bind="'time.time.tree.disableautoload.choice3load'"></span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--Tree-->
    <div class="timetree-view">
        <div class="timetree-view-content" data-ng-if="ctrl.tree.groupNodes && ctrl.tree.groupNodes.length > 0">
            <div class="row">
                <div class="col-sm-12">
                    <ul data-show="ctrl.tree">
                        <li ng-repeat="groupNode in ctrl.tree.groupNodes" ng-include="'timeEmployeeTreeGroup'" data-ng-click="$event.stopPropagation();ctrl.groupNodeClick(groupNode)"></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="noresult" data-ng-if="ctrl.tree && (!ctrl.tree.groupNodes || ctrl.tree.groupNodes.length == 0)">
            <div class="row">
                <div class="col-sm-12">
                    <span data-l10n-bind="'common.noresult'"></span>
                </div>
            </div>
        </div>
    </div>
</div>