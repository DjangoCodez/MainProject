<form name="ctrl.edit" class="ngSoeForm" novalidate autocomplete="off" data-form-state="ctrl.dirtyHandler.isDirty" confirm-on-exit>
    <!-- Must use ng-show here instead of ng-if, otherwise the DraggableDialogDirective won't find it -->
    <div class="modal-header" data-ng-show="ctrl.isModal">
        <button type="button" class="close" data-dismiss="modal" ng-click="ctrl.closeModal(false)" aria-hidden="true">&times;</button>
    </div>
    <soe-progressbar is-busy="ctrl.progress.progressBusy" message="ctrl.progress.progressMessage"></soe-progressbar>

    <div data-ng-if="!ctrl.progress.progressBusy" ng-class="ctrl.isModal ? 'edit-padding': ''">
        <soe-toolbar buttons="ctrl.toolbar.buttonGroups" navigator-records="ctrl.toolbar.navigatorRecords" navigator-selected-record="ctrl.toolbar.selectedRecord" navigator-show-position="true" navigator-show-dropdown="true" navigator-on-selection-changed="ctrl.toolbar.selectedRecordChanged(record);">
        </soe-toolbar>
        <soe-panel label-key="time.schedule.incomingdelivery.incomingdelivery">
            <div class="form-group form-group-sm">
                <div class="row">
                    <div class="col-sm-4">
                        <div class="row">
                            <div class="col-sm-12">
                                <soe-textbox label-key="common.name" model="ctrl.incomingDeliveryHead.name" required="true" tabindex="1" maxlength="100"></soe-textbox>
                            </div>
                            <div class="col-sm-12">
                                <soe-textarea label-key="common.description" model="ctrl.incomingDeliveryHead.description" tabindex="2" rows="3"></soe-textarea>
                            </div>
                            <div class="col-sm-12" data-ng-if="ctrl.useAccountsHierarchy">
                                <soe-select label-key="common.user.attestrole.accounthierarchy" model="ctrl.selectedAccount" items="ctrl.accounts" options="item as item.name for item in items"></soe-select>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="row">
                            <div class="col-sm-12">
                                <soe-panel label-key="common.dailyrecurrencepattern">
                                    <div class="form-group form-group-sm">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <span>{{ctrl.incomingDeliveryHead.patternDescription}}</span>
                                            </div>
                                        </div>
                                        <div class="row margin-small-top">
                                            <div class="col-sm-12">
                                                <span>{{ctrl.incomingDeliveryHead.startDateDescription}}</span>
                                            </div>
                                        </div>
                                        <div class="row margin-small-top">
                                            <div class="col-sm-12">
                                                <span>{{ctrl.incomingDeliveryHead.stopDateDescription}}</span>
                                            </div>
                                        </div>
                                        <div class="row margin-small-top" data-ng-if="ctrl.incomingDeliveryHead.excludedDates && ctrl.incomingDeliveryHead.excludedDates.length>0">
                                            <div class="col-sm-12">
                                                <span data-l10n-bind="'common.dailyrecurrencepattern.excludeddates'"></span>: <span>{{ctrl.incomingDeliveryHead.excludedDatesDescription}}</span>
                                            </div>
                                        </div>
                                        <div class="row margin-small-top">
                                            <div class="col-sm-12">
                                                <button type="button" class="btn btn-sm btn-default" tabindex="-1" data-ng-click="ctrl.openRecurrencePatternDialog()">
                                                    <span class="fal fa-repeat"></span>
                                                    <span data-l10n-bind="'common.dailyrecurrencepattern.editpattern'" data-ng-if="ctrl.incomingDeliveryHead.recurrencePattern"></span>
                                                    <span data-l10n-bind="'common.dailyrecurrencepattern.createpattern'" data-ng-if="!ctrl.incomingDeliveryHead.recurrencePattern"></span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </soe-panel>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </soe-panel>
        <soe-panel label-key="time.schedule.incomingdelivery.rows">
            <div class="form-group form-group-sm">
                <div class="row">
                    <div class="margin-large-bottom row">
                        <div class="col-sm-12">
                            <div class="pull-right margin-large-left btn-toolbar btn-toolbar-no-border" style="margin: 0px;">
                                <div class="btn-group">
                                    <i class="btn btn-sm btn-default fal fa-plus pull-right margin-small-right" data-ng-click="ctrl.addRow()"><span data-l10n-bind="'common.newrow'"></span></i>
                                </div>
                            </div>
                            <div class="pull-right margin-large-left btn-toolbar btn-toolbar-no-border" style="margin: 0px;">
                                <div class="btn-group">
                                    <i class="btn btn-sm btn-default fal fa-sync pull-right margin-small-right" data-ng-click="ctrl.tryReloadRows()"><span data-l10n-bind="'time.schedule.incomingdelivery.reloadrows'"></span></i>
                                </div>
                            </div>
                            <div class="form-group form-group-sm pull-right info" data-ng-if="ctrl.hasRows()" style="margin:0 5px 5px 5px">
                                <i data-l10n-bind data-l10n-bind-title="'time.schedule.incomingdelivery.row.dontassignbreakleftovers'" class="fal fa-user-times"></i>
                                <span data-l10n-bind="'time.schedule.incomingdelivery.row.dontassignbreakleftovers'" tabindex="-1"></span>
                            </div>
                            <div class="form-group form-group-sm pull-right info" data-ng-if="ctrl.hasRows()" style="margin:0 5px 5px 5px">
                                <i data-l10n-bind data-l10n-bind-title="'time.schedule.incomingdelivery.row.allowoverlapping'" class="fal fa-user-friends"></i>
                                <span data-l10n-bind="'time.schedule.incomingdelivery.row.allowoverlapping'" tabindex="-1"></span>
                            </div>
                            <div class="form-group form-group-sm pull-right info" data-ng-if="ctrl.hasRows()" style="margin:0 5px 5px 5px">
                                <i data-l10n-bind data-l10n-bind-title="'time.schedule.incomingdelivery.row.onlyoneemployee'" class="fal fa-user-tie"></i>
                                <span data-l10n-bind="'time.schedule.incomingdelivery.row.onlyoneemployee'" tabindex="-1"></span>
                            </div>
                            <div class="form-group form-group-sm pull-right info" data-ng-if="ctrl.hasRows()" style="margin:0 5px 5px 5px">
                                <i data-l10n-bind data-l10n-bind-title="'time.schedule.incomingdelivery.row.minsplitlength'" class="fal fa-cut"></i>
                                <span data-l10n-bind="'time.schedule.incomingdelivery.row.minsplitlength'" tabindex="-1"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div data-ng-if="!ctrl.hasRows()">
                    <div class="row">
                        <div class="col-sm-12">
                            <soe-instruction label-key="time.schedule.incomingdelivery.norows"></soe-instruction>
                        </div>
                    </div>
                </div>
                <div data-ng-if="ctrl.hasRows" data-ng-repeat="row in ctrl.incomingDeliveryHead.rows | orderBy:['rowNr'] track by $index" class="repeater-condensed" style="padding-right: 0px;" data-ng-click="ctrl.selectedRow = row">
                    <div class="form-group form-group-sm">
                        <div data-ng-if="$first">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row" style="margin:0">
                                        <div class="col-sm-3">
                                            <soe-label label-key="common.name" tabindex="-1"></soe-label>
                                        </div>
                                        <div class="col-sm-3">
                                            <soe-label label-key="common.description" tabindex="-1"></soe-label>
                                        </div>
                                        <div class="col-sm-3">
                                            <soe-label label-key="time.schedule.shifttype.shifttype" tabindex="-1"></soe-label>
                                        </div>
                                        <div class="col-sm-3">
                                            <soe-label label-key="time.schedule.incomingdeliverytype.incomingdeliverytype" tabindex="-1"></soe-label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row" style="margin:0">
                                        <div class="col-sm-8">
                                            <div class="row" style="margin:0">
                                                <div class="col-sm-2">
                                                    <soe-label label-key="time.schedule.incomingdelivery.row.nbrofpackages" tabindex="-1"></soe-label>
                                                </div>
                                                <div class="col-sm-2">
                                                    <soe-label label-key="time.schedule.incomingdelivery.row.totallength" tabindex="-1"></soe-label>
                                                </div>
                                                <div class="col-sm-2">
                                                    <soe-label label-key="time.schedule.incomingdelivery.row.nbrofpersons" tabindex="-1"></soe-label>
                                                </div>
                                                <div class="col-sm-2">
                                                    <soe-label label-key="time.schedule.incomingdelivery.row.length" tabindex="-1"></soe-label>
                                                </div>
                                                <div class="col-sm-2">
                                                    <soe-label label-key="time.schedule.incomingdelivery.row.starttime" tabindex="-1"></soe-label>
                                                </div>
                                                <div class="col-sm-2">
                                                    <soe-label label-key="time.schedule.incomingdelivery.row.stoptime" tabindex="-1"></soe-label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="row" style="margin:0">
                                                <div class="col-sm-4">
                                                    <i data-l10n-bind data-l10n-bind-title="'time.schedule.incomingdelivery.row.minsplitlength'" class="fal fa-cut"></i>
                                                </div>
                                                <div class="col-sm-4">
                                                    <div class="row" style="margin:0">
                                                        <div class="col-sm-4" style="text-align:center">
                                                            <i data-l10n-bind data-l10n-bind-title="'time.schedule.incomingdelivery.row.onlyoneemployee'" class="fal fa-user-tie"></i>
                                                        </div>
                                                        <div class="col-sm-4" style="text-align:center">
                                                            <i data-l10n-bind data-l10n-bind-title="'time.schedule.incomingdelivery.row.allowoverlapping'" class="fal fa-user-friends"></i>
                                                        </div>
                                                        <div class="col-sm-4" style="text-align:center">
                                                            <i data-l10n-bind data-l10n-bind-title="'time.schedule.incomingdelivery.row.dontassignbreakleftovers'" class="fal fa-user-times"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4">
                                                    &nbsp;
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" data-ng-class="{'repeater-selected-row': ctrl.selectedRow === row}">
                            <div incoming-delivery-rows-validation ng-model="row" min-length="ctrl.companySettingMinLength">
                                <div class="col-sm-6">
                                    <div class="row" style="margin:0">
                                        <div class="col-sm-3">
                                            <i class="fas fa-caret-right" data-ng-if="ctrl.selectedRow === row"></i>
                                            <soe-textbox hidelabel="true" model="row.name" update-on="blur" tab-with-enter set-focus="$last"></soe-textbox>
                                        </div>
                                        <div class="col-sm-3">
                                            <soe-textbox hidelabel="true" model="row.description" update-on="blur" tab-with-enter></soe-textbox>
                                        </div>
                                        <div class="col-sm-3">
                                            <soe-typeahead hidelabel="true" model="row.selectedShiftType" items="ctrl.shiftTypes" options="item as item.name for item in items" tab-with-enter on-focus="ctrl.selectedRow = row"></soe-typeahead>
                                        </div>
                                        <div class="col-sm-3" data-ng-if="!row.selectedIncomingDeliveryType || row.selectedIncomingDeliveryType.incomingDeliveryTypeId === 0">
                                            <soe-typeahead hidelabel="true" model="row.selectedIncomingDeliveryType" items="ctrl.incomingDeliveryTypes" options="item as item.name for item in items" tab-with-enter on-focus="ctrl.selectedRow = row" on-selection-changed="ctrl.incomingDeliveryTypeChanged(row)"></soe-typeahead>
                                        </div>
                                        <div class="col-sm-3" data-ng-if="row.selectedIncomingDeliveryType && row.selectedIncomingDeliveryType.incomingDeliveryTypeId > 0">
                                            <div class="row" style="margin:0">
                                                <div class="col-sm-8">
                                                    <soe-typeahead hidelabel="true" model="row.selectedIncomingDeliveryType" items="ctrl.incomingDeliveryTypes" options="item as item.name for item in items" tab-with-enter on-focus="ctrl.selectedRow = row" on-selection-changed="ctrl.incomingDeliveryTypeChanged(row)"></soe-typeahead>
                                                </div>
                                                <div class="col-sm-4">
                                                    <span style="text-align:left;vertical-align:middle">{{row.selectedIncomingDeliveryType.length}}</span> <span data-l10n-bind="'core.time.short.minute'" class="lowercase"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row" style="margin:0">
                                        <div class="col-sm-8">
                                            <div class="row" style="margin:0">
                                                <div class="col-sm-2">
                                                    <soe-textbox hidelabel="true" model="row.nbrOfPackages" numeric="true" update-on="blur" tab-with-enter on-change="ctrl.nbrOfPackagesChanged(row)"></soe-textbox>
                                                </div>
                                                <div class="col-sm-2">
                                                    <soe-textbox hidelabel="true" is-readonly="true" model="row.totalLengthTimeSpan" is-time="true" update-on="blur" tab-with-enter></soe-textbox>
                                                </div>
                                                <div class="col-sm-2">
                                                    <div class="row" style="margin:0;display: inline-block;white-space:nowrap;">
                                                        <div class="col-sm-3" style="text-align:center">
                                                            <span>1 - </span>
                                                        </div>
                                                        <div class="col-sm-9" style="text-align:center">
                                                            <soe-textbox hidelabel="true" model="row.nbrOfPersons" numeric="true" update-on="blur" tab-with-enter on-change="ctrl.nbrOfPersonsChanged(row)"></soe-textbox>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-2">
                                                    <soe-textbox hidelabel="true" model="row.lengthTimeSpan" update-on="blur" is-time="true" on-change="ctrl.lengthTimeSpanChanged(row)" tab-with-enter></soe-textbox>
                                                </div>
                                                <div class="col-sm-2">
                                                    <soe-timebox hidelabel="true" model="row.startTime" is-time="true" tab-with-enter changed="ctrl.startTimeChanged(row)">></soe-timebox>
                                                </div>
                                                <div class="col-sm-2">
                                                    <soe-timebox hidelabel="true" model="row.stopTime" is-time="true" tab-with-enter changed="ctrl.stopTimeChanged(row)">></soe-timebox>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="row" style="margin:0">
                                                <div class="col-sm-4">
                                                    <soe-textbox hidelabel="true" is-readonly="row.onlyOneEmployee === true" model="row.minSplitLengthTimeSpan" is-time="true" update-on="blur" on-change="ctrl.minSplitLengthTimeSpanChanged(row)" tab-with-enter></soe-textbox>
                                                </div>
                                                <div class="col-sm-4">
                                                    <div class="row" style="margin:0">
                                                        <div class="col-sm-4" style="text-align:center">
                                                            <soe-checkbox hidelabel="true" model="row.onlyOneEmployee" update-on="blur" tab-with-enter on-changing="ctrl.onlyOneEmployeeChanged(row)" style="margin:0"></soe-checkbox>
                                                        </div>
                                                        <div class="col-sm-4" style="text-align:center">
                                                            <soe-checkbox hidelabel="true" model="row.allowOverlapping" update-on="blur" tab-with-enter on-changing="ctrl.allowOverLappingChanged(row)" style="margin-top:0"></soe-checkbox>
                                                        </div>
                                                        <div class="col-sm-4" style="text-align:center">
                                                            <soe-checkbox hidelabel="true" model="row.dontAssignBreakLeftovers" update-on="blur" tab-with-enter style="margin-top:0"></soe-checkbox>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4">
                                                    <div class="row" style="margin:0">
                                                        <div class="col-sm-6" style="text-align:center">
                                                            <button type="button" class="btn btn-sm btn-link fal fa-times iconDelete skip-tab-with-enter" data-l10n-bind data-l10n-bind-title="'core.delete'" data-ng-click="$event.stopPropagation();ctrl.deleteRow(row)"></button>
                                                        </div>
                                                        <div class="col-sm-6" style="text-align:center" data-ng-if="ctrl.isRowValid(row)">
                                                            <button type="button" class="btn btn-sm btn-link fal fa-info-circle infoColor skip-tab-with-enter" data-l10n-bind data-l10n-bind-title="'core.info'" data-ng-click="$event.stopPropagation();ctrl.showRowValidation(row)"></button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </soe-panel>
        <div class="ngSoeFormFooter">
            <div class="col-sm-4">
                <created-modified model="ctrl.incomingDeliveryHead"></created-modified>
            </div>
            <div class="col-sm-8">
                <div class="pull-right">
                    <div class="col" data-ng-include src="ctrl.deleteButtonTemplateUrl" />
                    <div class="col" data-ng-class="{'no-border-radius-on-specified-last-button' : ctrl.edit.$invalid}">
                        <soe-splitbutton button-name="btnSave" label-key="core.save" options="ctrl.saveFunctions" main-button="true" last-button-class="last-button"  drop-up="true" data-ng-if="ctrl.modifyPermission" is-disabled="ctrl.isDisabled()" option-selected="ctrl.executeSaveFunction(option)"></soe-splitbutton>
                    </div>
                    <button type="button" class="btn btn-sm ngSoeMainButtonInvalid  no-left-border-radius" data-l10n-bind data-l10n-bind-title="'error.unabletosave_tooltip'" data-ng-if="ctrl.modifyPermission" data-ng-show="ctrl.edit.$invalid" data-ng-click="$event.stopPropagation();ctrl.showValidationError()">!</button>
                </div>
            </div>
        </div>
    </div>
</form>
