<form name="ctrl.edit" class="messagebox modal-wide" novalidate autocomplete="off">
    <div template-schedule-validation ng-model="ctrl.templateHead" placement-exists="ctrl.placementExistsOnCurrentTemplate" placement-function="ctrl.placementFunction" placement-start-date="ctrl.placementStartDate" placement-stop-date="ctrl.placementStopDate" employee-schedule-start-date="ctrl.placement.employeeScheduleStartDate">
        <div class="modal-header templateview-header">
            <button type="button" class="close" data-ng-click="ctrl.cancel()">&times;</button>
            <h6 class="modal-title">
                <span>{{ctrl.title}}</span>
            </h6>
        </div>
        <soe-progressbar is-busy="ctrl.progressBusy" message="ctrl.progressMessage"></soe-progressbar>
        <div class="modal-body" data-ng-if="!ctrl.progressBusy">
            <div class="row">
                <div class="col-sm-5">
                    <div class="info margin-large-bottom">
                        <div class="row margin-small-bottom">
                            <div class="col-sm-12">
                                <span class="indiscreet"><span data-l10n-bind="'time.schedule.planning.templateschedule.employee'"></span> <span>{{ctrl.employee.name}}</span></span>
                                <div data-ng-if="ctrl.templateHead.name">
                                    <span>{{ctrl.templateHead.name}}</span>
                                </div>
                                <div data-ng-if="!ctrl.templateHead.name">
                                    <span data-l10n-bind="'time.schedule.planning.contextmenu.newtemplate'"></span>
                                </div>
                            </div>
                        </div>
                        <div class="margin-large-right">
                            <div class="row">
                                <div class="col-sm-offset-4 col-sm-4 text-right">
                                    <soe-label label-key="time.schedule.planning.templateschedule.worktime.rule"></soe-label>
                                </div>
                                <div class="col-sm-4 text-right">
                                    <soe-label label-key="time.schedule.planning.templateschedule.worktime.schedule"></soe-label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4">
                                    <span class="indiscreet" data-l10n-bind="'time.schedule.planning.templateschedule.worktime.average'"></span>
                                </div>
                                <div class="col-sm-4 text-right">
                                    <span>{{ctrl.employee.oneWeekWorkTimeMinutes | minutesToTimeSpan}}</span>
                                </div>
                                <div class="col-sm-4 text-right">
                                    <span>{{ctrl.totalWorkTimeMinutes / ctrl.nbrOfWeeks | minutesToTimeSpan}}</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4">
                                    <span class="indiscreet" data-l10n-bind="'time.schedule.planning.templateschedule.worktime.total'"></span>
                                </div>
                                <div class="col-sm-4 text-right">
                                    <span>{{ctrl.employee.oneWeekWorkTimeMinutes * ctrl.nbrOfWeeks | minutesToTimeSpan}}</span>
                                </div>
                                <div class="col-sm-4 text-right">
                                    <span>{{ctrl.totalWorkTimeMinutes | minutesToTimeSpan}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-7">
                    <div class="row" data-ng-if="ctrl.templateHead.locked">
                        <div class="warning margin-large-left margin-large-right">
                            <div class="row">
                                <div class="col-sm-1">
                                    <i class="fal fa-lock-alt" style="font-size: 22px;"></i>
                                </div>
                                <div class="col-sm-11">
                                    <soe-label discreet="true" label-key="time.schedule.planning.templateschedule.locked"></soe-label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" data-ng-if="ctrl.useAccountHierarchy && !ctrl.isTemplateGroup">
                        <div class="col-sm-offset-6 col-sm-6">
                            <soe-radiobutton label-key="time.schedule.planning.templateschedule.useaccountingfromsourceschedule" model="ctrl.useAccountingFromSourceSchedule" group="accounting" value="true" inline="true" on-changing="ctrl.useAccountingFromSourceScheduleChanged();"></soe-radiobutton>
                            <soe-radiobutton label-key="time.schedule.planning.templateschedule.useaccountingfromemployee" model="ctrl.useAccountingFromSourceSchedule" group="accounting" value="false" inline="true" on-changing="ctrl.useAccountingFromSourceScheduleChanged();"></soe-radiobutton>
                        </div>
                    </div>
                    <div class="row" data-ng-if="ctrl.isTemplateGroup">
                        <div class="warning margin-large-left margin-large-right">
                            <div class="row">
                                <div class="col-sm-12">
                                    <span class="indiscreet" data-l10n-bind="'time.schedule.planning.templateschedule.istemplategroup'"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" data-ng-if="!ctrl.templateHead.locked && !ctrl.isTemplateGroup">
                        <div class="col-sm-6">
                            <soe-typeahead label-key="time.schedule.planning.templateschedule.copyfrom.employee" placeholder-key="core.typetofilter"  model="ctrl.copyFromEmployeeId" items="ctrl.employees" options="item.employeeId as item.numberAndName for item in items"  on-edit="ctrl.setsourceId()" edit-icon="fa-caret-down" edit-tooltip-key="core.edit" edit-class="border-radius-right" filter-property="numberAndName" limit="1000"></soe-typeahead>
                        </div>
                        <div class="col-sm-6">
                            <soe-select label-key="time.schedule.planning.templateschedule.copyfrom.schedule" model="ctrl.copyFromTemplateHeadId" items="ctrl.employeeTemplates" options="item.timeScheduleTemplateHeadId as item.description for item in items"></soe-select>
                        </div>
                    </div>
                    <div class="row margin-small-top margin-small-bottom" data-ng-if="!ctrl.templateHead.locked && !ctrl.isTemplateGroup">
                        <div class="col-sm-offset-6 col-sm-6">
                            <span class="indiscreet" data-l10n-bind="'time.schedule.planning.templateschedule.rotateshifts'"></span>
                            <div class="btn-group pull-right" role="group">
                                <button type="button" class="btn btn-default btn-sm fal fa-chevron-down" data-l10n-bind data-l10n-bind-title="'time.schedule.planning.templateschedule.rotateshifts.forward'" ng-click="ctrl.rotateShifts(true);"></button>
                                <button type="button" class="btn btn-default btn-sm fal fa-chevron-up border-radius-right" data-l10n-bind data-l10n-bind-title="'time.schedule.planning.templateschedule.rotateshifts.backward'" ng-click="ctrl.rotateShifts(false);"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-5">
                    <soe-panel label-key="time.schedule.planning.templateschedule.headtitle">
                        <div class="row margin-small-bottom">
                            <div class="col-sm-3 padding-none-right">
                                <soe-textbox label-key="core.time.weeks" model="ctrl.nbrOfWeeks" numeric="true" decimals="0" update-on="blur" is-disabled="ctrl.templateHead.locked || ctrl.isTemplateGroup" on-change="ctrl.nbrOfWeeksChanged()"></soe-textbox>
                            </div>
                            <div class="col-sm-5 padding-none-right">
                                <soe-datepicker label-key="time.schedule.planning.templateschedule.startdate" model="ctrl.templateHead.startDate" required="true" is-disabled="ctrl.templateHead.locked || ctrl.isTemplateGroup" on-change="ctrl.startDateChanged();"></soe-datepicker>
                            </div>
                            <div class="col-sm-4">
                                <soe-textbox label-key="time.schedule.planning.templateschedule.weekincycle" model="ctrl.weekInCycle" numeric="true" decimals="0" update-on="blur" is-disabled="ctrl.templateHead.locked || ctrl.isTemplateGroup" on-change="ctrl.weekInCycleChanged()"></soe-textbox>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <div data-ng-class="{'info': ctrl.startDateIsFirstMondayOfCycle, 'warning': !ctrl.startDateIsFirstMondayOfCycle}">
                                    <soe-label label-key="time.schedule.planning.templateschedule.firstmondayofcycle"></soe-label>
                                    <span>{{ctrl.templateHead.firstMondayOfCycle | date:'shortDate'}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="row" data-ng-if="ctrl.useStopDate">
                            <div class="col-sm-8">
                                <soe-datepicker label-key="time.schedule.planning.templateschedule.stopdate" model="ctrl.templateHead.stopDate" is-disabled="ctrl.templateHead.locked || ctrl.isTemplateGroup"></soe-datepicker>
                            </div>
                        </div>
                    </soe-panel>
                    <div class="row margin-small-bottom">
                        <div class="col-sm-12">
                            <div class="info" data-ng-if="ctrl.placement && ctrl.placement.timeScheduleTemplateHeadId">
                                <soe-label label-key="time.schedule.planning.templateschedule.lastplacement"></soe-label>
                                <span><span>{{ctrl.placement.employeeScheduleStartDate | date:'shortDate'}}</span> - <span>{{ctrl.placement.employeeScheduleStopDate | date:'shortDate'}}</span></span>
                                <div>
                                    <span>{{ctrl.placement.timeScheduleTemplateHeadName}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="info" data-ng-if="ctrl.placementExistsOnCurrentTemplate">
                                <soe-label label-key="time.schedule.planning.templateschedule.placementexistsoncurrenttemplate"></soe-label>
                                <span data-ng-bind-html="ctrl.placementExistsInfo"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row margin-small-top" data-ng-if="ctrl.mode == 3">
                        <div class="col-sm-12">
                            <uib-accordion close-others="false">
                                <soe-accordion label-key="time.schedule.planning.templateschedule.activate" is-open="ctrl.activateExpanderOpen">
                                    <div class="row">
                                        <div class="col-sm-8">
                                            <soe-select label-key="time.schedule.planning.templateschedule.activate.function" model="ctrl.placementFunction" items="ctrl.placementFunctions" options="item.id as item.name for item in items" on-changing="ctrl.placementFunctionChanged()"></soe-select>
                                        </div>
                                        <div class="col-sm-8" data-ng-if="ctrl.placementFunction == 1">
                                            <soe-datepicker label-key="time.schedule.planning.templateschedule.activate.startdate" model="ctrl.placementStartDate"></soe-datepicker>
                                        </div>
                                        <div class="col-sm-8">
                                            <soe-datepicker label-key="time.schedule.planning.templateschedule.activate.stopdate" model="ctrl.placementStopDate"></soe-datepicker>
                                        </div>
                                        <div class="col-sm-8" data-ng-if="!ctrl.placementHidePreliminary">
                                            <soe-checkbox label-key="time.schedule.planning.templateschedule.activate.preliminary" model="ctrl.placementPreliminary"></soe-checkbox>
                                        </div>
                                    </div>
                                </soe-accordion>
                            </uib-accordion>
                        </div>
                    </div>
                </div>
                <div class="col-sm-7">
                    <soe-panel label-key="time.schedule.planning.templateschedule.rowstitle">
                        <div class="table-scrollable-wrapper" style="margin: -40px -15px -15px -15px;">
                            <div class="table-scrollable" style="height: 300px;">
                                <table class="table table-more-condensed table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th scope="col" data-l10n-bind="'core.time.week'"></th>
                                            <th scope="col" data-l10n-bind="'core.time.day'"></th>
                                            <th scope="col" data-l10n-bind="'common.shifttype'"></th>
                                            <th scope="col" data-l10n-bind="'common.from'"></th>
                                            <th scope="col" data-l10n-bind="'common.to'"></th>
                                            <th scope="col" data-l10n-bind="'time.schedule.planning.break'"></th>
                                            <th scope="col" data-l10n-bind="'common.length'"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr data-ng-repeat="shift in ctrl.templateShifts">
                                            <td class="right-align-cell">
                                                <span>{{shift.weekNbr}}</span>
                                            </td>
                                            <td>
                                                <span>{{shift.dayOfWeek | getDayName | toUpperCaseFirstLetter}}</span>
                                            </td>
                                            <td>
                                                <span>{{shift.shiftTypeName}}</span>
                                            </td>
                                            <td>
                                                <span>{{shift.startTime | date:'shortTime'}}</span>
                                            </td>
                                            <td>
                                                <span>{{shift.stopTime | date:'shortTime'}}</span>
                                            </td>
                                            <td>
                                                <span>{{shift.breakLength | minutesToTimeSpan}}</span>
                                            </td>
                                            <td>
                                                <span>{{shift.duration | minutesToTimeSpan}}</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </soe-panel>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-sm btn-default" data-l10n-bind="'time.recalculatetimestatus'" data-l10n-bind-title="'time.recalculatetimestatus'" data-ng-click="ctrl.openRecalculateTimeStatusDialog(false)" data-ng-if="!ctrl.isTemplateGroup"></button>
            <button type="button" class="btn btn-sm btn-default" data-l10n-bind="'core.cancel'" data-l10n-bind-title="'core.cancel'" data-ng-click="ctrl.cancel()"></button>
            <button type="button" class="btn btn-sm btn-default" data-l10n-bind="'core.delete'" data-l10n-bind-title="'core.delete'" data-ng-if="ctrl.mode == 2 && !ctrl.isTemplateGroup" data-ng-disabled="ctrl.executing" data-ng-click="$event.stopPropagation();ctrl.initDelete()"></button>
            <button type="button" class="btn btn-sm ngSoeMainButton" data-l10n-bind="'core.save'" data-l10n-bind-title="'core.save'" data-ng-if="ctrl.mode !== 3 && !ctrl.isTemplateGroup" data-ng-show="ctrl.edit.$valid" data-ng-disabled="!ctrl.edit.$dirty || ctrl.edit.$invalid || ctrl.executing" data-ng-click="$event.stopPropagation();ctrl.initSave()"></button>
            <div class="btn-group" role="group" data-ng-if="ctrl.mode !== 3 && !ctrl.isTemplateGroup" data-ng-show="ctrl.edit.$invalid">
                <button type="button" class="btn btn-sm ngSoeMainButton" data-l10n-bind="'core.save'" data-ng-disabled="ctrl.edit.$invalid"></button>
                <button type="button" class="btn btn-sm ngSoeMainButtonInvalid" data-l10n-bind data-l10n-bind-title="'error.unabletosave_tooltip'" data-ng-click="$event.stopPropagation();ctrl.showValidationError()">!</button>
            </div>
            <button type="button" class="btn btn-sm ngSoeMainButton" data-l10n-bind="'time.schedule.planning.contextmenu.activate'" data-l10n-bind-title="'time.schedule.planning.templateschedule.activate'" data-ng-if="ctrl.mode == 3 && !ctrl.isTemplateGroup" data-ng-show="ctrl.edit.$valid" data-ng-disabled="!ctrl.edit.$dirty || ctrl.edit.$invalid || ctrl.executing" data-ng-click="$event.stopPropagation();ctrl.initActivate()"></button>
            <div class="btn-group" role="group" data-ng-if="ctrl.mode == 3 && !ctrl.isTemplateGroup" data-ng-show="ctrl.edit.$invalid">
                <button type="button" class="btn btn-sm ngSoeMainButton" data-l10n-bind="'time.schedule.planning.contextmenu.activate'" data-ng-disabled="ctrl.edit.$invalid"></button>
                <button type="button" class="btn btn-sm ngSoeMainButtonInvalid" data-l10n-bind data-l10n-bind-title="'error.unabletosave_tooltip'" data-ng-click="$event.stopPropagation();ctrl.showValidationError()">!</button>
            </div>
        </div>
    </div>
</form>