<form name="ctrl.edit" class="ngSoeForm" novalidate autocomplete="off" data-form-state="ctrl.dirtyHandler.isDirty" confirm-on-exit>
    <div class="modal-header" data-ng-show="ctrl.isModal">
        <button type="button" class="close" data-dismiss="modal" ng-click="ctrl.closeModal(false);" aria-hidden="true">&times;</button>
        <h6 class="modal-title" data-ng-if="ctrl.templateHead">{{ctrl.templateHead.name}}</h6>
    </div>
    <soe-progressbar is-busy="ctrl.progress.progressBusy" message="ctrl.progress.progressMessage"></soe-progressbar>

    <div ng-class="ctrl.isModal ? 'edit-padding': ''" templates-validation ng-model="ctrl.templateHead" placement="ctrl.placement" stop-date="ctrl.templateHead.stopDate" blocks="ctrl.blocks" shift-type-mandatory="ctrl.shiftTypeMandatory" has-overlapping-break-windows="ctrl.hasOverlappingBreakWindows" data-ng-if="!ctrl.progress.progressBusy">
        <soe-toolbar buttons="ctrl.toolbar.buttonGroups"></soe-toolbar>
        <uib-accordion close-others="false">
            <soe-accordion label-key="time.schedule.template.template" is-open="true">
                <div class="row margin-large-bottom" data-ng-if="ctrl.timeCodeLoaded && !ctrl.defaultTimeCodeId">
                    <div class="col-sm-12">
                        <div class="warning">
                            <span class="indiscreet largeFont" data-l10n-bind="'time.schedule.template.defaulttimecodemissing'"></span>
                        </div>
                    </div>
                </div>
                <div class="row margin-large-bottom" data-ng-if="ctrl.templateHead.timeScheduleTemplateHeadId && !ctrl.templateHead.simpleSchedule">
                    <div class="col-sm-12">
                        <div class="warning">
                            <div class="row">
                                <div class="col-sm-12">
                                    <span class="indiscreet largeFont" data-l10n-bind="'time.schedule.template.nosimpleschedulewarning.row1'"></span>
                                </div>
                                <div class="col-sm-12">
                                    <span class="indiscreet largeFont" data-l10n-bind="'time.schedule.template.nosimpleschedulewarning.row2'"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-sm-4">
                                <soe-textbox label-key="common.name" model="ctrl.templateHead.name" required="true" maxlength="100" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked"></soe-textbox>
                            </div>
                            <div class="col-sm-8">
                                <soe-textbox label-key="common.description" model="ctrl.templateHead.description" maxlength="512" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked"></soe-textbox>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-4">
                                <soe-typeahead label-key="common.employee" model="ctrl.employee" items="ctrl.employees" options="item as item.name for item in items" limit="50" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked || ctrl.templateIsInUse || ctrl.newForEmployeeId"></soe-typeahead>
                            </div>
                            <div class="col-sm-4">
                                <soe-datepicker label-key="common.startdate" model="ctrl.startDate" options="ctrl.startDateOptions" required="true" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked || ctrl.templateIsInUse"></soe-datepicker>
                            </div>
                            <div class="col-sm-4">
                                <soe-checkbox label-key="time.schedule.template.startonfirstdayofweek" model="ctrl.templateHead.startOnFirstDayOfWeek" inline="true" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked || ctrl.templateIsInUse || ctrl.defaultStartOnFirstDayOfWeek" on-changing="ctrl.startOnFirstDayOfWeekChanged();"></soe-checkbox>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-4">
                                <soe-textbox label-key="time.schedule.template.noofdays" model="ctrl.templateHead.noOfDays" required="true" numeric="true" decimals="0" update-on="blur" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked || ctrl.templateIsInUse" on-change="ctrl.noOfDaysChanged();"></soe-textbox>
                            </div>
                            <div class="col-sm-4" data-ng-if="ctrl.useStopDate">
                                <soe-datepicker label-key="common.stopdate" model="ctrl.templateHead.stopDate" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked"></soe-datepicker>
                            </div>
                            <div class="col-sm-4">
                                <soe-checkbox label-key="core.locked" model="ctrl.templateHead.locked" inline="true" is-disabled="!ctrl.modifyPermission || !ctrl.lockTemplatePermission"></soe-checkbox>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="row">
                            <div class="col-sm-12" data-ng-if="ctrl.hasPlacements && !ctrl.isUpdated">
                                <soe-label></soe-label>
                                <div class="info margin-small-top">
                                    <span data-l10n-bind="'time.schedule.template.lockedinfo'"></span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12" data-ng-if="ctrl.placement && ctrl.placement.timeScheduleTemplateHeadId">
                                <soe-label></soe-label>
                                <div class="info">
                                    <soe-label label-key="time.schedule.planning.templateschedule.lastplacement"></soe-label>
                                    <span><span>{{ctrl.placement.employeeScheduleStartDate | date:'shortDate'}}</span> - <span>{{ctrl.placement.employeeScheduleStopDate | date:'shortDate'}}</span></span>
                                    <div>
                                        <span>{{ctrl.placement.timeScheduleTemplateHeadName}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </soe-accordion>
            <soe-accordion label-key="time.schedule.planning.shifts" is-open="true">
                <div class="row margin-small-top margin-small-bottom" data-ng-if="ctrl.modifyPermission && !ctrl.templateHead.locked && !ctrl.templateIsInUse">
                    <div class="col-sm-12">
                        <button type="button" class="btn btn-sm btn-default pull-right margin-small-right" data-l10n-bind="'time.schedule.planning.editshift.new'" data-ng-click="$event.stopPropagation();ctrl.addBlock();"></button>
                        <button type="button" class="btn btn-sm btn-default pull-right margin-small-right" data-l10n-bind="'time.schedule.template.sortblocks'" data-ng-click="$event.stopPropagation();ctrl.sortBlocks();"></button>
                    </div>
                </div>
                <div class="margin-large-left margin-small-right repeater-semi-condensed" data-ng-repeat="block in ctrl.blocks" data-ng-click="ctrl.selectedBlock = block">
                    <div class="form-group form-group-sm">
                        <div data-ng-if="$first">
                            <div class="row">
                                <div class="col-sm-2">
                                    <soe-label label-key="common.shifttype"></soe-label>
                                </div>
                                <div class="col-sm-1">
                                    <soe-label label-key="time.schedule.template.daynumber"></soe-label>
                                </div>
                                <div class="col-sm-1">
                                    <soe-label label-key="common.from"></soe-label>
                                </div>
                                <div class="col-sm-1">
                                    <soe-label label-key="common.to"></soe-label>
                                </div>
                                <div class="col-sm-1">
                                    <soe-label label-key="time.schedule.planning.editshift.duration"></soe-label>
                                </div>
                                <div class="col-sm-5 padding-none-left padding-none-right margin-small-top">
                                    <div class="col-sm-3" data-ng-if="ctrl.maxNoOfBrakes>0">
                                        <span class="indiscreet" data-l10n-bind="'time.schedule.planning.break'"></span> <span class="indiscreet">1</span>
                                    </div>
                                    <div class="col-sm-3" data-ng-if="ctrl.maxNoOfBrakes>1">
                                        <span class="indiscreet" data-l10n-bind="'time.schedule.planning.break'"></span> <span class="indiscreet">2</span>
                                    </div>
                                    <div class="col-sm-3" data-ng-if="ctrl.maxNoOfBrakes>2">
                                        <span class="indiscreet" data-l10n-bind="'time.schedule.planning.break'"></span> <span class="indiscreet">3</span>
                                    </div>
                                    <div class="col-sm-3" data-ng-if="ctrl.maxNoOfBrakes>3">
                                        <span class="indiscreet" data-l10n-bind="'time.schedule.planning.break'"></span> <span class="indiscreet">4</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" data-ng-class="{'repeater-selected-row': ctrl.selectedBlock === block}" style="margin-left: -20px;">
                            <div class="col-sm-2">
                                <i class="fas fa-caret-right" data-ng-if="ctrl.selectedBlock === block"></i>
                                <soe-select hidelabel="true" model="block.shiftTypeId" items="ctrl.shiftTypes" options="item.id as item.name for item in items" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked || ctrl.templateIsInUse" set-focus="$last"></soe-select>
                            </div>
                            <div class="col-sm-1">
                                <soe-select hidelabel="true" model="block.dayNumber" items="ctrl.dayNumbers" options="item.id as item.name for item in items" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked || ctrl.templateIsInUse" on-changing="ctrl.dayNumberChanged(block);"></soe-select>
                            </div>
                            <div class="col-sm-1">
                                <soe-timebox hidelabel="true" model="block.startTime" is-time="true" style="margin-right: 8px;" data-ng-attr-title="{{block.startTime | date:'shortDate'}} {{block.startTime | date:'shortTime'}}" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked || ctrl.templateIsInUse" input-class="errorBackgroundColor" input-class-condition="block.overlapping" on-change="ctrl.timeChanged(block);"></soe-timebox>
                                <span class="fal fa-arrow-alt-from-left errorColor" style="position: absolute; top: 8px; right: -2px;" data-ng-if="ctrl.isAfterToday(block.startTime)"></span>
                            </div>
                            <div class="col-sm-1">
                                <soe-timebox hidelabel="true" model="block.stopTime" is-time="true" style="margin-right: 8px;" data-ng-attr-title="{{block.stopTime | date:'shortDate'}} {{block.stopTime | date:'shortTime'}}" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked || ctrl.templateIsInUse" input-class="errorBackgroundColor" input-class-condition="block.overlapping" on-change="ctrl.timeChanged(block);"></soe-timebox>
                                <span class="fal fa-arrow-alt-from-left warningColor" style="position: absolute; top: 8px; right: -2px;" data-ng-if="ctrl.isAfterToday(block.stopTime)"></span>
                            </div>
                            <div class="col-sm-1">
                                <soe-textbox hidelabel="true" model="block.duration | minutesToTimeSpan" input-class-no-condition="text-right" input-class="errorBackgroundColor" input-class-condition="block.duration<0" readonly="true"></soe-textbox>
                            </div>
                            <div class="col-sm-5 padding-none-left padding-none-right">
                                <div class="col-sm-3" data-ng-if="ctrl.maxNoOfBrakes>0">
                                    <soe-select hidelabel="true" model="block.break1TimeCodeId" items="ctrl.timeCodeBreaks" options="item.timeCodeId as item.name for item in items" input-class="errorBackgroundColor" input-class-condition="block.overlappingBreak1" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked || ctrl.templateIsInUse" on-changing="ctrl.breakTimeCodeChanged(block, 1);"></soe-select>
                                </div>
                                <div class="col-sm-3" data-ng-if="ctrl.maxNoOfBrakes>1">
                                    <soe-select hidelabel="true" model="block.break2TimeCodeId" items="ctrl.timeCodeBreaks" options="item.timeCodeId as item.name for item in items" input-class="errorBackgroundColor" input-class-condition="block.overlappingBreak2" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked || ctrl.templateIsInUse" on-changing="ctrl.breakTimeCodeChanged(block, 2);"></soe-select>
                                </div>
                                <div class="col-sm-3" data-ng-if="ctrl.maxNoOfBrakes>2">
                                    <soe-select hidelabel="true" model="block.break3TimeCodeId" items="ctrl.timeCodeBreaks" options="item.timeCodeId as item.name for item in items" input-class="errorBackgroundColor" input-class-condition="block.overlappingBreak3" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked || ctrl.templateIsInUse" on-changing="ctrl.breakTimeCodeChanged(block, 3);"></soe-select>
                                </div>
                                <div class="col-sm-3" data-ng-if="ctrl.maxNoOfBrakes>3">
                                    <soe-select hidelabel="true" model="block.break4TimeCodeId" items="ctrl.timeCodeBreaks" options="item.timeCodeId as item.name for item in items" input-class="errorBackgroundColor" input-class-condition="block.overlappingBreak4" is-disabled="!ctrl.modifyPermission || ctrl.templateHead.locked || ctrl.templateIsInUse" on-changing="ctrl.breakTimeCodeChanged(block, 4);"></soe-select>
                                </div>
                            </div>
                            <div class="col-sm-1" data-ng-if="ctrl.modifyPermission && !ctrl.templateHead.locked && !ctrl.templateIsInUse">
                                <button type="button" class="btn btn-sm btn-link fal fa-times iconDelete" data-l10n-bind data-l10n-bind-title="'core.delete'" data-ng-click="$event.stopPropagation();ctrl.deleteBlock(block);"></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="margin-large-top margin-large-bottom">
                        <div class="row">
                            <div class="col-sm-2 col-sm-offset-4">
                                <soe-textbox label-key="time.schedule.template.sumwork" model="ctrl.workMinutes | minutesToTimeSpan" input-class-no-condition="text-right" readonly="true"></soe-textbox>
                            </div>
                            <div class="col-sm-2">
                                <soe-textbox label-key="time.schedule.template.sumbreak" model="ctrl.breakMinutes | minutesToTimeSpan" input-class-no-condition="text-right" readonly="true"></soe-textbox>
                            </div>
                            <div class="col-sm-2">
                                <soe-textbox label-key="time.schedule.template.totalsum" model="ctrl.totalWorkMinutes | minutesToTimeSpan" input-class-no-condition="text-right" readonly="true"></soe-textbox>
                            </div>
                            <div class="col-sm-2">
                                <soe-textbox label-key="time.schedule.template.averageweek" model="ctrl.weekAverageMinutes | minutesToTimeSpan" input-class-no-condition="text-right" readonly="true"></soe-textbox>
                            </div>
                        </div>
                    </div>
                </div>
            </soe-accordion>
        </uib-accordion>

        <div class="ngSoeFormFooter">
            <div class="col-sm-4">
                <created-modified model="ctrl.templateHead"></created-modified>
            </div>
            <div class="col-sm-8">
                <div class="pull-right">
                    <div class="col"><soe-checkbox label-key="common.active" model="ctrl.templateHead.isActive" is-disabled="!ctrl.modifyPermission"></soe-checkbox></div>
                    <div class="col" data-ng-include src="ctrl.deleteButtonTemplateUrl" data-ng-if="!ctrl.templateHead.locked && !ctrl.templateIsInUse" />
                    <div class="col" data-ng-include src="ctrl.saveButtonTemplateUrl" data-ng-if="!ctrl.templateHead.locked && ctrl.defaultTimeCodeId" />
                </div>
            </div>
        </div>
    </div>
</form>