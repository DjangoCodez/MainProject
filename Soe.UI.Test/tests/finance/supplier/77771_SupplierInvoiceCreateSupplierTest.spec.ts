import { test } from '../../fixtures/finance-fixture';
import * as allure from "allure-js-commons";
import { getAccountExValue } from '../../../utils/properties';

let testCaseId: string = '77771';
let envUrl: string;
let supplierNo_1: string;


test.use({ account: { domain: process.env.defualt_domain!, user: 'adminERP' } });
test.beforeEach(async ({ accountEx, financeBasePage }) => {
    await allure.parentSuite("Finance");
    await allure.suite("Supplier");
    await allure.subSuite("Supplier");
    await allure.link('https://dev.azure.com/softonedev/XE/_workitems/edit/' + testCaseId, "Test case : " + testCaseId);
    envUrl = accountEx.baseUrl;
    await financeBasePage.SetupFinance(envUrl, getAccountExValue(accountEx, 'role')?.toString() ?? 'Admin');
    supplierNo_1 = testCaseId + Math.floor(100 + Math.random() * 900);
});

test(testCaseId + ': Supplier Invoice Create Supplier : AP', { tag: ['@Finance', '@Supplier', '@Regression'] }, async ({ financeBasePage, supplierInvoicePageJS, page }) => {
    const supplierName = `Test Supplier`;
    await financeBasePage.goToMenu('Supplier', 'Invoices');
    await supplierInvoicePageJS.createItem();
    await supplierInvoicePageJS.waitForNewSupplierInvoiceLoaded();
    await supplierInvoicePageJS.editSupplier();
    await supplierInvoicePageJS.enterSupplierNo(supplierNo_1);
    await supplierInvoicePageJS.enterSupplierName(supplierName);
    await supplierInvoicePageJS.saveSupplier();
    await supplierInvoicePageJS.clearSupplier();
    await page.waitForTimeout(500);
    await supplierInvoicePageJS.setSupplier(supplierNo_1 + ' ' + supplierName);
    await supplierInvoicePageJS.editSupplier(false);
    await supplierInvoicePageJS.verifySupplierName(supplierName);
    await supplierInvoicePageJS.verifySupplierNo(supplierNo_1);
    await supplierInvoicePageJS.enterSupplierName('Updated ' + supplierName);
    await supplierInvoicePageJS.saveSupplier(0, false);
    await supplierInvoicePageJS.clearSupplier();
    await supplierInvoicePageJS.setSupplier(supplierNo_1 + ' ' + 'Updated ' + supplierName);
    await supplierInvoicePageJS.editSupplier(false);
    await supplierInvoicePageJS.verifySupplierName('Updated ' + supplierName);
    await supplierInvoicePageJS.deleteSupplier();
    await supplierInvoicePageJS.verifySupplierNotSelected('Updated ' + supplierName);
});







































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































