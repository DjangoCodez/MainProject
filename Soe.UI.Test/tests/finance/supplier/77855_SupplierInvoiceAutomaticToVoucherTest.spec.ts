import { test } from '../../fixtures/finance-fixture';
import * as allure from "allure-js-commons";
import { getAccountExValue } from '../../../utils/properties';
import { SupplierInvoiceUtil } from '../../../apis/utils/SupplierInvoiceUtil';

let testCaseId: string = '77855';
let envUrl: string;
let invoiceNo_1: string;
let invoiceUtil: SupplierInvoiceUtil;

test.use({ account: { domain: process.env.defualt_domain!, user: 'adminERP' } });
test.beforeEach(async ({ page, accountEx, financeBasePage }) => {
    await allure.parentSuite("Finance");
    await allure.suite("Supplier");
    await allure.subSuite("Supplier");
    await allure.link('https://dev.azure.com/softonedev/XE/_workitems/edit/' + testCaseId, "Test case : " + testCaseId);
    envUrl = accountEx.baseUrl;
    await financeBasePage.SetupFinance(envUrl, getAccountExValue(accountEx, 'role')?.toString() ?? 'Admin');
    invoiceNo_1 = testCaseId + Math.floor(100000 + Math.random() * 900000);
    invoiceUtil = new SupplierInvoiceUtil(page, envUrl);
    await invoiceUtil.CreateSupplierInvoice(invoiceNo_1, true);
});

test(testCaseId + ': Supplier Invoice Automatic To Voucher : AP', { tag: ['@Finance', '@Supplier', '@Regression'] }, async ({ financeBasePage, accountPayableSettingsPage, supplierInvoicePageJS, voucherPageJS }) => {
    await financeBasePage.goToMenu('Settings_Finance', 'Settings', true, 'Accounts Payable');
    await accountPayableSettingsPage.transferInvoiceToVoucher(true);
    await accountPayableSettingsPage.saveAccountPayableSettings();
    await financeBasePage.goToMenu('Supplier', 'Invoices');
    await supplierInvoicePageJS.selectSupplierinvoiceByInvoiceNo(invoiceNo_1);
    await supplierInvoicePageJS.selectSupplierinvoice();
    await supplierInvoicePageJS.saveAsDefinitive();
    await supplierInvoicePageJS.reloadPage();
    const sequenceNo = await supplierInvoicePageJS.getInvoiceSequenceNo();
    await financeBasePage.goToMenu('Accounting', 'Voucher');
    await voucherPageJS.filterbyText(`Sup.inv. ${sequenceNo},`);
    await voucherPageJS.editVoucher();
    await voucherPageJS.verifyBalanceOfAccountingRows();
});







































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































